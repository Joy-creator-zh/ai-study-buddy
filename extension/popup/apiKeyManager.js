export class ApiKeyManager{constructor(){this.lastValidatedValue=""}async validateApiKey(e,o,t){if(!e)return!1;try{const r={deepseek:{url:"https://api.deepseek.com/v1/chat/completions",model:t?.model||"deepseek-chat"},volcengine:{url:"https://ark.cn-beijing.volces.com/api/v3/chat/completions",model:"r1"===t?.model?t?.r1model:t?.v3model},siliconflow:{url:"https://api.siliconflow.cn/v1/chat/completions",model:t?.model||"deepseek-ai/DeepSeek-V3"},openrouter:{url:"https://openrouter.ai/api/v1/chat/completions",model:t?.model||"deepseek/deepseek-chat:free"},tencentcloud:{url:"https://api.lkeap.cloud.tencent.com/v1/chat/completions",model:t?.model||"deepseek-v3"},iflytekstar:{url:"https://maas-api.cn-huabei-1.xf-yun.com/v1/chat/completions",model:t?.model||"xdeepseekv3"},baiducloud:{url:"https://qianfan.baidubce.com/v2/chat/completions",model:t?.model||"deepseek-v3"},aliyun:{url:"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",model:t?.model||"deepseek-v3"}}[o];if(!r)return!1;if("volcengine"===o&&!r.model)return!1;const s=await new Promise((o=>{chrome.runtime.sendMessage({action:"proxyRequest",url:r.url,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:"test"}],stream:!1})},o)}));return console.log("API validation response:",s),200===s?.status&&(await this.saveApiKey(e,o),!0)}catch(e){return console.error("Validation error:",e),!1}}async getApiKey(e){try{const o=`${e}ApiKey`;return new Promise((e=>{chrome.storage.sync.get(o,(t=>{e(t[o]||"")}))}))}catch(e){return console.error("Get API key error:",e),""}}async saveApiKey(e,o){try{const t=`${o}ApiKey`;return new Promise((o=>{chrome.storage.sync.set({[t]:e},(()=>{chrome.runtime.lastError?(console.error("Save API key error:",chrome.runtime.lastError),o(!1)):(this.lastValidatedValue=e,o(!0))}))}))}catch(e){return console.error("Save API key error:",e),!1}}}